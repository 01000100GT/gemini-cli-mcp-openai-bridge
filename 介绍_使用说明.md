# Gemini CLI MCP/OpenAI æ¡¥æ¥æœåŠ¡å™¨ - é¡¹ç›®ä»‹ç»ä¸ä½¿ç”¨è¯´æ˜

## é¡¹ç›®æ¦‚è¿°

`@intelligentinternet/gemini-cli-mcp-openai-bridge` æ˜¯ä¸€ä¸ªåŸºäº Google å¼€æº Gemini CLI æ„å»ºçš„å¤šåŠŸèƒ½æ¡¥æ¥æœåŠ¡å™¨ï¼Œæä¾›ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š

1. **MCP (Model Context Protocol) å·¥å…·åŒ…æœåŠ¡å™¨** - å°† Gemini CLI çš„æ‰€æœ‰å†…ç½®å·¥å…·é€šè¿‡æ ‡å‡†åŒ–çš„ MCP åè®®æš´éœ²
2. **OpenAI å…¼å®¹ API æ¡¥æ¥å™¨** - æä¾›å®Œå…¨å…¼å®¹ OpenAI Chat Completions API çš„ç«¯ç‚¹

## é¡¹ç›®æ¶æ„ (ASTL - Architecture, Structure, Technology, Logic)

### Architecture (æ¶æ„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®¢æˆ·ç«¯åº”ç”¨å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   MCP å®¢æˆ·ç«¯    â”‚    â”‚    OpenAI API å®¢æˆ·ç«¯           â”‚ â”‚
â”‚  â”‚  (Claude, etc.) â”‚    â”‚  (Open WebUI, ChatGPT, etc.)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Bridge Server (Express.js)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   MCP ç«¯ç‚¹      â”‚    â”‚    OpenAI API ç«¯ç‚¹             â”‚ â”‚
â”‚  â”‚   /mcp          â”‚    â”‚    /v1/chat/completions        â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚    /v1/models                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Gemini CLI Core                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   å·¥å…·æ³¨å†Œè¡¨    â”‚    â”‚    Gemini API å®¢æˆ·ç«¯           â”‚ â”‚
â”‚  â”‚  Tool Registry  â”‚    â”‚    (è®¤è¯ & æ¨¡å‹è°ƒç”¨)            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Google Gemini API                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Structure (é¡¹ç›®ç»“æ„)

```
gemini-cli-mcp-openai-bridge/
â”œâ”€â”€ ğŸ“ bridge-server/                    # æ ¸å¿ƒæ¡¥æ¥æœåŠ¡å™¨ä»£ç 
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ bridge/                   # æ¡¥æ¥é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ bridge.ts               # MCP æ¡¥æ¥æ ¸å¿ƒç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ openai.ts               # OpenAI API å…¼å®¹å±‚
â”‚   â”‚   â”‚   â””â”€â”€ stream-transformer.ts   # æµå¼å“åº”è½¬æ¢å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“ config/                   # é…ç½®ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ config.ts               # ä¸»é…ç½®åŠ è½½å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ settings.ts             # è®¾ç½®æ–‡ä»¶è§£æ
â”‚   â”‚   â”‚   â”œâ”€â”€ extension.ts            # æ‰©å±•é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ sandboxConfig.ts        # æ²™ç®±é…ç½®
â”‚   â”‚   â”œâ”€â”€ ğŸ“ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ logger.ts               # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ error-mapper.ts         # é”™è¯¯æ˜ å°„
â”‚   â”‚   â”‚   â”œâ”€â”€ package.ts              # åŒ…ä¿¡æ¯
â”‚   â”‚   â”‚   â””â”€â”€ version.ts              # ç‰ˆæœ¬ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ index.ts                    # æœåŠ¡å™¨å…¥å£ç‚¹
â”‚   â”‚   â”œâ”€â”€ gemini-client.ts            # Gemini å®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â”œâ”€â”€ mcp-test-client.ts          # MCP æµ‹è¯•å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ types.ts                    # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ package.json                    # ä¾èµ–é…ç½®
â”‚   â””â”€â”€ tsconfig.json                   # TypeScript é…ç½®
â”œâ”€â”€ ğŸ“ gemini-cli/                       # Google Gemini CLI å­æ¨¡å—
â”œâ”€â”€ ğŸ“ .trae/                           # Trae AI IDE é…ç½®
â”œâ”€â”€ ğŸ“ .vscode/                         # VS Code é…ç½®
â”œâ”€â”€ _example.settings.json              # ç¤ºä¾‹é…ç½®æ–‡ä»¶
â”œâ”€â”€ Dockerfile                          # Docker å®¹å™¨é…ç½®
â”œâ”€â”€ package.json                        # æ ¹é¡¹ç›®é…ç½®
â””â”€â”€ README.zh.md                        # ä¸­æ–‡è¯´æ˜æ–‡æ¡£
```

### Technology (æŠ€æœ¯æ ˆ)

#### æ ¸å¿ƒæŠ€æœ¯
- **Node.js** (â‰¥18.0.0) - è¿è¡Œæ—¶ç¯å¢ƒ
- **TypeScript** - ä¸»è¦å¼€å‘è¯­è¨€
- **Express.js** - Web æœåŠ¡å™¨æ¡†æ¶
- **@google/gemini-cli-core** - Google Gemini CLI æ ¸å¿ƒåº“
- **@modelcontextprotocol/sdk** - MCP åè®®å®ç°

#### å…³é”®ä¾èµ–
- **openai** - OpenAI API ç±»å‹å®šä¹‰å’Œå®¢æˆ·ç«¯
- **zod** - è¿è¡Œæ—¶ç±»å‹éªŒè¯
- **undici** - é«˜æ€§èƒ½ HTTP å®¢æˆ·ç«¯
- **dotenv** - ç¯å¢ƒå˜é‡ç®¡ç†
- **express** - HTTP æœåŠ¡å™¨
- **command-exists** - å‘½ä»¤å­˜åœ¨æ€§æ£€æŸ¥

#### å¼€å‘å·¥å…·
- **vitest** - æµ‹è¯•æ¡†æ¶
- **eslint** - ä»£ç æ£€æŸ¥
- **prettier** - ä»£ç æ ¼å¼åŒ–
- **rimraf** - è·¨å¹³å°æ–‡ä»¶åˆ é™¤
- **shx** - è·¨å¹³å° shell å‘½ä»¤

### Logic (æ ¸å¿ƒé€»è¾‘)

#### 1. å®‰å…¨ç­–ç•¥ç³»ç»Ÿ

é¡¹ç›®å®ç°äº†å››å±‚å®‰å…¨æ¨¡å¼ï¼š

```typescript
type SecurityMode = 'read-only' | 'edit' | 'configured' | 'yolo';

// read-only: ä»…å…è®¸åªè¯»å·¥å…· (é»˜è®¤)
// edit: å…è®¸æ–‡ä»¶ç¼–è¾‘ï¼Œç¦æ­¢ shell å‘½ä»¤
// configured: åŸºäºé…ç½®æ–‡ä»¶çš„ç²¾ç»†æ§åˆ¶
// yolo: å…è®¸æ‰€æœ‰æ“ä½œ (é«˜é£é™©)
```

#### 2. å·¥å…·æ³¨å†Œä¸è¿‡æ»¤

```typescript
// å·¥å…·è¿‡æ»¤é€»è¾‘
switch (securityPolicy.mode) {
  case 'read-only':
    // ä»…æ³¨å†Œåªè¯»å·¥å…·
    tools = allTools.filter(tool => isReadOnlyTool(tool.name));
    break;
  case 'edit':
    // æ’é™¤ shell å‘½ä»¤å·¥å…·
    tools = allTools.filter(tool => tool.name !== 'run_shell_command');
    break;
  case 'configured':
    // åŸºäºç™½åå•è¿‡æ»¤
    tools = allTools.filter(tool => allowedTools.includes(tool.name));
    break;
  case 'yolo':
    // å…è®¸æ‰€æœ‰å·¥å…·
    tools = allTools;
    break;
}
```

#### 3. MCP åè®®æ¡¥æ¥

```typescript
// MCP æœåŠ¡å™¨åˆ›å»ºå’Œå·¥å…·æ³¨å†Œ
const server = new McpServer({
  name: 'gemini-cli-bridge-server',
  version: cliVersion,
}, {
  capabilities: {
    logging: {},
    geminiCliSecurityPolicy: securityPolicy,
  },
});

// æ³¨å†Œ Gemini CLI å·¥å…·ä¸º MCP å·¥å…·
for (const tool of availableTools) {
  server.setRequestHandler(CallToolRequestSchema, async (request) => {
    const result = await tool.execute(request.params.arguments);
    return { content: [{ type: 'text', text: result.text }] };
  });
}
```

#### 4. OpenAI API å…¼å®¹å±‚

```typescript
// OpenAI æ¶ˆæ¯æ ¼å¼è½¬æ¢ä¸º Gemini æ ¼å¼
function convertOpenAIToGemini(messages: OpenAIMessage[]): Content[] {
  return messages.map(msg => ({
    role: msg.role === 'assistant' ? 'model' : 'user',
    parts: [{ text: msg.content }]
  }));
}

// Gemini å“åº”è½¬æ¢ä¸º OpenAI æ ¼å¼
function convertGeminiToOpenAI(response: GenerateContentResponse): OpenAIChatCompletion {
  return {
    id: randomUUID(),
    object: 'chat.completion',
    created: Math.floor(Date.now() / 1000),
    model: 'gemini-2.5-flash',
    choices: [{
      index: 0,
      message: {
        role: 'assistant',
        content: response.text()
      },
      finish_reason: 'stop'
    }]
  };
}
```

## è¯¦ç»†ä½¿ç”¨è¯´æ˜

### 1. ç¯å¢ƒå‡†å¤‡

#### ç³»ç»Ÿè¦æ±‚
- **Node.js** â‰¥ 18.0.0
- **npm** æˆ– **yarn**
- **Git** (ç”¨äºå­æ¨¡å—)
- **macOS/Linux/Windows** (æ¨è macOS/Linux)

#### è®¤è¯é…ç½®

é¡¹ç›®ä½¿ç”¨ä¸ Gemini CLI ç›¸åŒçš„è®¤è¯æœºåˆ¶ï¼š

```bash
# æ–¹å¼1: ä½¿ç”¨ API Key
export GEMINI_API_KEY="your-api-key-here"

# æ–¹å¼2: ä½¿ç”¨ Google Cloud è®¤è¯
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/service-account.json"

# æ–¹å¼3: ä½¿ç”¨ gcloud CLI (æ¨è)
gcloud auth application-default login
```

### 2. å®‰è£…ä¸å¯åŠ¨

#### å…¨å±€å®‰è£… (æ¨è)

```bash
# å®‰è£…
npm install -g @intelligentinternet/gemini-cli-bridge

# å¯åŠ¨æœåŠ¡å™¨
gemini-cli-bridge

# è‡ªå®šä¹‰é…ç½®å¯åŠ¨
gemini-cli-bridge --host=0.0.0.0 --port=9000 --debug
```

#### ä»æºç æ„å»º

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Intelligent-Internet/gemini-cli-common-bridge.git
cd gemini-cli-common-bridge

# å®‰è£…ä¾èµ– (ä¼šè‡ªåŠ¨åˆå§‹åŒ–å­æ¨¡å—)
npm install

# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨æœåŠ¡å™¨
npm run start
```

#### Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t gemini-cli-bridge .

# è¿è¡Œå®¹å™¨
docker run -p 8765:8765 \
  -e GEMINI_API_KEY="your-api-key" \
  gemini-cli-bridge
```

### 3. å‘½ä»¤è¡Œå‚æ•°è¯¦è§£

| å‚æ•° | åˆ«å | ç¯å¢ƒå˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|--------|---------|
| `--host` | `-h` | - | `127.0.0.1` | æœåŠ¡å™¨ç›‘å¬åœ°å€ |
| `--port` | `-p` | `GEMINI_MCP_PORT` | `8765` | æœåŠ¡å™¨ç«¯å£ |
| `--target-dir` | `-d` | - | å½“å‰ç›®å½• | æ–‡ä»¶æ“ä½œæ ¹ç›®å½• |
| `--debug` | - | - | `false` | å¯ç”¨è°ƒè¯•æ—¥å¿— |
| `--use-internal-prompt` | - | - | `false` | åŠ è½½å†…éƒ¨ GEMINI.md æç¤º |
| `--tools-model` | - | `GEMINI_TOOLS_DEFAULT_MODEL` | `gemini-2.5-flash` | å·¥å…·æ‰§è¡Œæ¨¡å‹ |
| `--mode` | - | - | `read-only` | å®‰å…¨æ¨¡å¼ |
| `--allow-mcp-proxy` | - | - | `false` | å…è®¸ MCP ä»£ç†å·¥å…· |
| `--resolve-redirects` | - | - | `false` | è§£æé‡å®šå‘ URL |
| `--i-know-what-i-am-doing` | - | - | `false` | è·³è¿‡å®‰å…¨ç¡®è®¤ |

### 4. å®‰å…¨é…ç½®è¯¦è§£

#### å®‰å…¨æ¨¡å¼è¯´æ˜

1. **read-only** (é»˜è®¤ï¼Œæœ€å®‰å…¨)
   - âœ… å…è®¸ï¼š`read_file`, `list_directory`, `glob`, `google_web_search`
   - âŒ ç¦æ­¢ï¼šæ‰€æœ‰å†™å…¥æ“ä½œã€shell å‘½ä»¤ã€MCP ä»£ç†

2. **edit** (å¹³è¡¡æ¨¡å¼)
   - âœ… å…è®¸ï¼šæ‰€æœ‰æ–‡ä»¶è¯»å†™æ“ä½œ
   - âŒ ç¦æ­¢ï¼š`run_shell_command`ã€MCP ä»£ç†

3. **configured** (è‡ªå®šä¹‰æ¨¡å¼)
   - å®Œå…¨åŸºäº `settings.json` é…ç½®
   - éœ€è¦æ˜ç¡®åˆ—å‡ºå…è®¸çš„å·¥å…·

4. **yolo** (æœ€å±é™©)
   - âœ… å…è®¸ï¼šæ‰€æœ‰æœ¬åœ°å·¥å…·
   - âš ï¸ é£é™©ï¼šå¯æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤

#### é…ç½®æ–‡ä»¶ç¤ºä¾‹

åˆ›å»º `.gemini/settings.json`ï¼š

```json
{
  "securityPolicy": {
    "mode": "configured",
    "allowedTools": [
      "read_file",
      "write_file",
      "list_directory",
      "google_web_search",
      "run_shell_command"
    ],
    "shellCommandPolicy": {
      "allow": [
        "ls", "git status", "npm install", "npm test"
      ],
      "deny": [
        "rm", "sudo", "docker", "chmod"
      ]
    }
  },
  "mcpServers": {
    "github": {
      "command": "docker",
      "args": ["run", "-i", "--rm", "-e", "GITHUB_PERSONAL_ACCESS_TOKEN=${GITHUB_PAT}", "ghcr.io/github/github-mcp-server"],
      "trust": true
    }
  }
}
```

### 5. API ä½¿ç”¨ç¤ºä¾‹

#### MCP å®¢æˆ·ç«¯è¿æ¥

```python
# Python MCP å®¢æˆ·ç«¯ç¤ºä¾‹
import asyncio
from mcp import ClientSession, StdioServerParameters
from mcp.client.stdio import stdio_client

async def main():
    server_params = StdioServerParameters(
        command="curl",
        args=["-X", "POST", "http://localhost:8765/mcp"]
    )
    
    async with stdio_client(server_params) as (read, write):
        async with ClientSession(read, write) as session:
            # åˆå§‹åŒ–è¿æ¥
            await session.initialize()
            
            # åˆ—å‡ºå¯ç”¨å·¥å…·
            tools = await session.list_tools()
            print(f"Available tools: {[tool.name for tool in tools.tools]}")
            
            # è°ƒç”¨å·¥å…·
            result = await session.call_tool(
                "read_file",
                {"file_path": "/path/to/file.txt"}
            )
            print(f"File content: {result.content}")

asyncio.run(main())
```

#### OpenAI API å…¼å®¹è°ƒç”¨

```python
# ä½¿ç”¨ OpenAI Python å®¢æˆ·ç«¯
from openai import OpenAI

client = OpenAI(
    base_url="http://localhost:8765/v1",
    api_key="dummy-key"  # ä¸éœ€è¦çœŸå® API key
)

# èŠå¤©è¡¥å…¨
response = client.chat.completions.create(
    model="gemini-2.5-flash",
    messages=[
        {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŠ©æ‰‹ã€‚"},
        {"role": "user", "content": "è¯·å¸®æˆ‘è¯»å–å½“å‰ç›®å½•ä¸‹çš„ README.md æ–‡ä»¶"}
    ],
    tools=[
        {
            "type": "function",
            "function": {
                "name": "read_file",
                "description": "è¯»å–æ–‡ä»¶å†…å®¹",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "file_path": {
                            "type": "string",
                            "description": "æ–‡ä»¶è·¯å¾„"
                        }
                    },
                    "required": ["file_path"]
                }
            }
        }
    ]
)

print(response.choices[0].message.content)
```

```javascript
// JavaScript/Node.js ç¤ºä¾‹
const OpenAI = require('openai');

const client = new OpenAI({
  baseURL: 'http://localhost:8765/v1',
  apiKey: 'dummy-key'
});

async function chatWithTools() {
  const response = await client.chat.completions.create({
    model: 'gemini-2.5-flash',
    messages: [
      { role: 'user', content: 'è¯·æœç´¢æœ€æ–°çš„ AI æ–°é—»' }
    ],
    tools: [
      {
        type: 'function',
        function: {
          name: 'google_web_search',
          description: 'æœç´¢ç½‘ç»œä¿¡æ¯',
          parameters: {
            type: 'object',
            properties: {
              query: { type: 'string', description: 'æœç´¢æŸ¥è¯¢' }
            },
            required: ['query']
          }
        }
      }
    ]
  });
  
  console.log(response.choices[0].message.content);
}

chatWithTools();
```

#### cURL ç¤ºä¾‹

```bash
# è·å–å¯ç”¨æ¨¡å‹
curl -X GET http://localhost:8765/v1/models

# èŠå¤©è¡¥å…¨
curl -X POST http://localhost:8765/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-2.5-flash",
    "messages": [
      {"role": "user", "content": "Hello, world!"}
    ]
  }'

# æµå¼å“åº”
curl -X POST http://localhost:8765/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-2.5-flash",
    "messages": [
      {"role": "user", "content": "å†™ä¸€é¦–è¯—"}
    ],
    "stream": true
  }'
```

### 6. é›†æˆç¤ºä¾‹

#### ä¸ Open WebUI é›†æˆ

1. åœ¨ Open WebUI ä¸­æ·»åŠ æ–°çš„ OpenAI å…¼å®¹æ¨¡å‹ï¼š
   - Base URL: `http://localhost:8765/v1`
   - API Key: `dummy-key`
   - Model: `gemini-2.5-flash`

2. å¯ç”¨å·¥å…·è°ƒç”¨åŠŸèƒ½ï¼Œå³å¯ä½¿ç”¨ Gemini CLI çš„æ‰€æœ‰å·¥å…·

#### ä¸ Claude Desktop é›†æˆ

åœ¨ Claude Desktop çš„ MCP é…ç½®ä¸­æ·»åŠ ï¼š

```json
{
  "mcpServers": {
    "gemini-cli-bridge": {
      "command": "curl",
      "args": ["-X", "POST", "http://localhost:8765/mcp"]
    }
  }
}
```

### 7. æ•…éšœæ’é™¤

#### å¸¸è§é—®é¢˜

1. **è®¤è¯å¤±è´¥**
   ```bash
   # æ£€æŸ¥è®¤è¯çŠ¶æ€
   gcloud auth application-default print-access-token
   
   # é‡æ–°è®¤è¯
   gcloud auth application-default login
   ```

2. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æŸ¥çœ‹ç«¯å£å ç”¨
   lsof -i :8765
   
   # ä½¿ç”¨å…¶ä»–ç«¯å£
   gemini-cli-bridge --port=9000
   ```

3. **å­æ¨¡å—æœªåˆå§‹åŒ–**
   ```bash
   # æ‰‹åŠ¨åˆå§‹åŒ–å­æ¨¡å—
   git submodule update --init --recursive
   ```

4. **å·¥å…·æƒé™è¢«æ‹’ç»**
   - æ£€æŸ¥å®‰å…¨æ¨¡å¼è®¾ç½®
   - ç¡®è®¤å·¥å…·åœ¨ `allowedTools` åˆ—è¡¨ä¸­
   - æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—äº†è§£å…·ä½“åŸå› 

#### è°ƒè¯•æŠ€å·§

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
gemini-cli-bridge --debug

# æ£€æŸ¥é…ç½®
gemini-cli-bridge --debug --mode=configured

# æµ‹è¯•ç‰¹å®šå·¥å…·
curl -X POST http://localhost:8765/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 1,
    "method": "tools/list"
  }'
```

### 8. æ€§èƒ½ä¼˜åŒ–

#### æ¨èé…ç½®

```bash
# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
gemini-cli-bridge \
  --host=0.0.0.0 \
  --port=8765 \
  --mode=configured \
  --tools-model=gemini-2.5-flash \
  --target-dir=/app/workspace
```

#### èµ„æºç›‘æ§

```bash
# ç›‘æ§æœåŠ¡å™¨çŠ¶æ€
top -p $(pgrep -f gemini-cli-bridge)

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
ps aux | grep gemini-cli-bridge
```

## æ€»ç»“

æœ¬é¡¹ç›®æˆåŠŸåœ°å°† Google Gemini CLI çš„å¼ºå¤§åŠŸèƒ½é€šè¿‡æ ‡å‡†åŒ–çš„ MCP å’Œ OpenAI API æ¥å£æš´éœ²å‡ºæ¥ï¼Œä¸º AI åº”ç”¨å¼€å‘æä¾›äº†ä¸€ä¸ªå®‰å…¨ã€çµæ´»ã€æ˜“äºé›†æˆçš„æ¡¥æ¥è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡åˆ†å±‚çš„å®‰å…¨ç­–ç•¥å’Œä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œæ—¢ä¿è¯äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œåˆæä¾›äº†è¶³å¤Ÿçš„çµæ´»æ€§æ¥æ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚ã€‚