[DEBUG] /rotation/PersistenceService.ts - saveData: 获取文件锁成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 持久化数据写入文件成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 释放文件锁
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 轮换状态保存成功
[rotation/ApiKeyRotationManager] 成功获取API Key: AIzaSyAGqu...
[rotation/RotationService] [API请求] 成功获取轮换API Key: AIzaSyAGqu...
[GeminiApiClient] [请求时序5] 成功获取轮换API Key
[GeminiApiClient] [请求时序6] 开始执行实际请求
[GeminiApiClient] [回退时序4] 当前使用模型: gemini-2.5-pro
2025-07-25T05:51:07.648Z [BRIDGE-SERVER] [INFO] Calling Gemini API { model: 'gemini-2.5-pro' }
[GeminiApiClient] [请求时序7] 使用轮换API Key创建ContentGenerator
[GeminiApiClient] [DEBUG] 动态配置详情: {
  model: 'gemini-2.5-pro',
  hasApiKey: true,
  apiKeyPrefix: 'AIzaSyAGqu...',
  authType: 'gemini-api-key'
}
Attempt 1 failed with status 429. Retrying with backoff... ApiError: {"error":{"message":"{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.\",\n    \"status\": \"RESOURCE_EXHAUSTED\",\n    \"details\": [\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.QuotaFailure\",\n        \"violations\": [\n          {\n            \"quotaMetric\": \"generativelanguage.googleapis.com/generate_content_free_tier_input_token_count\",\n            \"quotaId\": \"GenerateContentInputTokensPerModelPerMinute-FreeTier\",\n            \"quotaDimensions\": {\n              \"location\": \"global\",\n              \"model\": \"gemini-2.5-pro\"\n            },\n            \"quotaValue\": \"250000\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.Help\",\n        \"links\": [\n          {\n            \"description\": \"Learn more about Gemini API quotas\",\n            \"url\": \"https://ai.google.dev/gemini-api/docs/rate-limits\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.RetryInfo\",\n        \"retryDelay\": \"50s\"\n      }\n    ]\n  }\n}\n","code":429,"status":"Too Many Requests"}}
    at throwErrorIfNotOK (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13187:30)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:12978:13
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34 {
  status: 429
}
Attempt 2 failed with status 429. Retrying with backoff... ApiError: {"error":{"message":"{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.\",\n    \"status\": \"RESOURCE_EXHAUSTED\",\n    \"details\": [\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.QuotaFailure\",\n        \"violations\": [\n          {\n            \"quotaMetric\": \"generativelanguage.googleapis.com/generate_content_free_tier_input_token_count\",\n            \"quotaId\": \"GenerateContentInputTokensPerModelPerMinute-FreeTier\",\n            \"quotaDimensions\": {\n              \"location\": \"global\",\n              \"model\": \"gemini-2.5-pro\"\n            },\n            \"quotaValue\": \"250000\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.Help\",\n        \"links\": [\n          {\n            \"description\": \"Learn more about Gemini API quotas\",\n            \"url\": \"https://ai.google.dev/gemini-api/docs/rate-limits\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.RetryInfo\",\n        \"retryDelay\": \"46s\"\n      }\n    ]\n  }\n}\n","code":429,"status":"Too Many Requests"}}
    at throwErrorIfNotOK (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13187:30)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:12978:13
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34 {
  status: 429
}
Attempt 3 failed with status 429. Retrying with backoff... ApiError: {"error":{"message":"{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.\",\n    \"status\": \"RESOURCE_EXHAUSTED\",\n    \"details\": [\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.QuotaFailure\",\n        \"violations\": [\n          {\n            \"quotaMetric\": \"generativelanguage.googleapis.com/generate_content_free_tier_input_token_count\",\n            \"quotaId\": \"GenerateContentInputTokensPerModelPerMinute-FreeTier\",\n            \"quotaDimensions\": {\n              \"location\": \"global\",\n              \"model\": \"gemini-2.5-pro\"\n            },\n            \"quotaValue\": \"250000\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.Help\",\n        \"links\": [\n          {\n            \"description\": \"Learn more about Gemini API quotas\",\n            \"url\": \"https://ai.google.dev/gemini-api/docs/rate-limits\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.RetryInfo\",\n        \"retryDelay\": \"32s\"\n      }\n    ]\n  }\n}\n","code":429,"status":"Too Many Requests"}}
    at throwErrorIfNotOK (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13187:30)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:12978:13
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34 {
  status: 429
}
Attempt 4 failed with status 429. Retrying with backoff... ApiError: {"error":{"message":"{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.\",\n    \"status\": \"RESOURCE_EXHAUSTED\",\n    \"details\": [\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.QuotaFailure\",\n        \"violations\": [\n          {\n            \"quotaMetric\": \"generativelanguage.googleapis.com/generate_content_free_tier_input_token_count\",\n            \"quotaId\": \"GenerateContentInputTokensPerModelPerMinute-FreeTier\",\n            \"quotaDimensions\": {\n              \"location\": \"global\",\n              \"model\": \"gemini-2.5-pro\"\n            },\n            \"quotaValue\": \"250000\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.Help\",\n        \"links\": [\n          {\n            \"description\": \"Learn more about Gemini API quotas\",\n            \"url\": \"https://ai.google.dev/gemini-api/docs/rate-limits\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.RetryInfo\",\n        \"retryDelay\": \"17s\"\n      }\n    ]\n  }\n}\n","code":429,"status":"Too Many Requests"}}
    at throwErrorIfNotOK (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13187:30)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:12978:13
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34 {
  status: 429
}
[fallback/errorDetection] 检查是否应该触发回退: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 判断错误类型: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测Pro模型配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测通用配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测Pro模型配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测限速错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测服务器错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 错误类型 unknown_error 不需要触发回退
[fallback/FallbackService] 回退触发检查结果: false
[GeminiApiClient] [回退时序5] 是否需要回退: false
[rotation/RotationService] 报告API Key使用结果: key=AIzaSyAGqu..., success=false, errorType=undefined
[rotation/ApiKeyRotationManager] 报告API Key使用结果: key=AIzaSyAGqu..., success=false, errorType=undefined
[rotation/ApiKeyRotationManager] Key 2 使用失败，连续失败次数: 1
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 开始保存轮换状态
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 准备保存的数据 {
  currentIndex: 2,
  totalRequests: 59,
  keysCount: 3,
  persistenceFile: './data/rotation-state.json'
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 开始保存持久化数据 {
  filePath: '/Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/data/rotation-state.json',
  currentIndex: 2,
  totalRequests: 59,
  keysCount: 3
}
2025-07-25T05:52:23.654Z [BRIDGE-SERVER] [ERROR] false Gemini API请求失败 {
  message: 'exception TypeError: fetch failed sending request',
  stack: 'Error: exception TypeError: fetch failed sending request\n' +
    '    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)\n' +
    '    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)\n' +
    '    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)\n' +
    '    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)\n' +
    '    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34'
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 获取文件锁成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 持久化数据写入文件成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 释放文件锁
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 轮换状态保存成功
2025-07-25T05:52:23.655Z [BRIDGE-SERVER] [ERROR] OpenAI bridge request failed {
  message: 'exception TypeError: fetch failed sending request',
  stack: 'Error: exception TypeError: fetch failed sending request\n' +
    '    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)\n' +
    '    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)\n' +
    '    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)\n' +
    '    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)\n' +
    '    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34'
} {
  requestId: 'd17db0e7-f783-4c0e-a05b-e1f7d4591869',
  durationMs: 76012
}
[rotation/ApiKeyRotationManager] Key 2 使用报告处理完成
[rotation/RotationService] API Key使用报告成功提交
2025-07-25T05:52:24.178Z [BRIDGE-SERVER] [INFO] OpenAI bridge request received {
  requestId: 'd2b65ca2-d553-4d4a-b906-20a12b625f04',
  model: 'gemini-2.5-pro',
  stream: true
}
[GeminiApiClient] [请求时序1] 收到sendMessageStream请求
[GeminiApiClient] [请求时序4] 开始获取轮换API Key
[rotation/RotationService] [API请求] 请求获取API Key，当前状态: enabled=true, manager=true, initializing=false
[rotation/RotationService] [API请求] 从轮换管理器获取下一个API Key
[rotation/ApiKeyRotationManager] 请求获取下一个API Key，当前索引: 2
[rotation/ApiKeyRotationManager] 开始轮换查找，最大尝试次数: 3
[rotation/ApiKeyRotationManager] 尝试第1次，检查索引2的Key状态: active
[rotation/ApiKeyRotationManager] Key 3/3 可用，开始使用
[rotation/ApiKeyRotationManager] 已移动到下一个索引: 0
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 开始保存轮换状态
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 准备保存的数据 {
  currentIndex: 0,
  totalRequests: 60,
  keysCount: 3,
  persistenceFile: './data/rotation-state.json'
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 开始保存持久化数据 {
  filePath: '/Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/data/rotation-state.json',
  currentIndex: 0,
  totalRequests: 60,
  keysCount: 3
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 获取文件锁成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 持久化数据写入文件成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 释放文件锁
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 轮换状态保存成功
[rotation/ApiKeyRotationManager] 成功获取API Key: AIzaSyBIy5...
[rotation/RotationService] [API请求] 成功获取轮换API Key: AIzaSyBIy5...
[GeminiApiClient] [请求时序5] 成功获取轮换API Key
[GeminiApiClient] [请求时序6] 开始执行实际请求
[GeminiApiClient] [回退时序4] 当前使用模型: gemini-2.5-pro
2025-07-25T05:52:24.179Z [BRIDGE-SERVER] [INFO] Calling Gemini API { model: 'gemini-2.5-pro' }
[GeminiApiClient] [请求时序7] 使用轮换API Key创建ContentGenerator
[GeminiApiClient] [DEBUG] 动态配置详情: {
  model: 'gemini-2.5-pro',
  hasApiKey: true,
  apiKeyPrefix: 'AIzaSyBIy5...',
  authType: 'gemini-api-key'
}
[fallback/errorDetection] 检查是否应该触发回退: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 判断错误类型: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测Pro模型配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测通用配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测Pro模型配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测限速错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测服务器错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 错误类型 unknown_error 不需要触发回退
[fallback/FallbackService] 回退触发检查结果: false
[GeminiApiClient] [回退时序5] 是否需要回退: false
[rotation/RotationService] 报告API Key使用结果: key=AIzaSyBIy5..., success=false, errorType=undefined
[rotation/ApiKeyRotationManager] 报告API Key使用结果: key=AIzaSyBIy5..., success=false, errorType=undefined
[rotation/ApiKeyRotationManager] Key 3 使用失败，连续失败次数: 1
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 开始保存轮换状态
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 准备保存的数据 {
  currentIndex: 0,
  totalRequests: 60,
  keysCount: 3,
  persistenceFile: './data/rotation-state.json'
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 开始保存持久化数据 {
  filePath: '/Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/data/rotation-state.json',
  currentIndex: 0,
  totalRequests: 60,
  keysCount: 3
}
2025-07-25T05:52:34.707Z [BRIDGE-SERVER] [ERROR] false Gemini API请求失败 {
  message: 'exception TypeError: fetch failed sending request',
  stack: 'Error: exception TypeError: fetch failed sending request\n' +
    '    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)\n' +
    '    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)\n' +
    '    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)\n' +
    '    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)\n' +
    '    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34'
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 获取文件锁成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 持久化数据写入文件成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 释放文件锁
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 轮换状态保存成功
2025-07-25T05:52:34.708Z [BRIDGE-SERVER] [ERROR] OpenAI bridge request failed {
  message: 'exception TypeError: fetch failed sending request',
  stack: 'Error: exception TypeError: fetch failed sending request\n' +
    '    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)\n' +
    '    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)\n' +
    '    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)\n' +
    '    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)\n' +
    '    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34'
} {
  requestId: 'd2b65ca2-d553-4d4a-b906-20a12b625f04',
  durationMs: 10530
}
[rotation/ApiKeyRotationManager] Key 3 使用报告处理完成
[rotation/RotationService] API Key使用报告成功提交
2025-07-25T05:52:35.611Z [BRIDGE-SERVER] [INFO] OpenAI bridge request received {
  requestId: '9dce0a69-325a-4826-b758-805b2fc64302',
  model: 'gemini-2.5-pro',
  stream: true
}
[GeminiApiClient] [请求时序1] 收到sendMessageStream请求
[GeminiApiClient] [请求时序4] 开始获取轮换API Key
[rotation/RotationService] [API请求] 请求获取API Key，当前状态: enabled=true, manager=true, initializing=false
[rotation/RotationService] [API请求] 从轮换管理器获取下一个API Key
[rotation/ApiKeyRotationManager] 请求获取下一个API Key，当前索引: 0
[rotation/ApiKeyRotationManager] 开始轮换查找，最大尝试次数: 3
[rotation/ApiKeyRotationManager] 尝试第1次，检查索引0的Key状态: active
[rotation/ApiKeyRotationManager] Key 1/3 可用，开始使用
[rotation/ApiKeyRotationManager] 已移动到下一个索引: 1
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 开始保存轮换状态
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 准备保存的数据 {
  currentIndex: 1,
  totalRequests: 61,
  keysCount: 3,
  persistenceFile: './data/rotation-state.json'
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 开始保存持久化数据 {
  filePath: '/Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/data/rotation-state.json',
  currentIndex: 1,
  totalRequests: 61,
  keysCount: 3
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 获取文件锁成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 持久化数据写入文件成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 释放文件锁
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 轮换状态保存成功
[rotation/ApiKeyRotationManager] 成功获取API Key: AIzaSyAN8B...
[rotation/RotationService] [API请求] 成功获取轮换API Key: AIzaSyAN8B...
[GeminiApiClient] [请求时序5] 成功获取轮换API Key
[GeminiApiClient] [请求时序6] 开始执行实际请求
[GeminiApiClient] [回退时序4] 当前使用模型: gemini-2.5-pro
2025-07-25T05:52:35.613Z [BRIDGE-SERVER] [INFO] Calling Gemini API { model: 'gemini-2.5-pro' }
[GeminiApiClient] [请求时序7] 使用轮换API Key创建ContentGenerator
[GeminiApiClient] [DEBUG] 动态配置详情: {
  model: 'gemini-2.5-pro',
  hasApiKey: true,
  apiKeyPrefix: 'AIzaSyAN8B...',
  authType: 'gemini-api-key'
}
Error flushing log events: Error: Client network socket disconnected before secure TLS connection was established
    at TLSSocket.onConnectEnd (node:_tls_wrap:1732:19)
    at TLSSocket.emit (node:events:530:35)
    at endReadableNT (node:internal/streams/readable:1698:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:90:21) {
  code: 'ECONNRESET',
  path: undefined,
  host: undefined,
  port: undefined,
  localAddress: undefined
}
Error flushing log events: Error: Client network socket disconnected before secure TLS connection was established
    at TLSSocket.onConnectEnd (node:_tls_wrap:1732:19)
    at TLSSocket.emit (node:events:530:35)
    at endReadableNT (node:internal/streams/readable:1698:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:90:21) {
  code: 'ECONNRESET',
  path: undefined,
  host: undefined,
  port: undefined,
  localAddress: undefined
}
Error flushing log events: Error: Client network socket disconnected before secure TLS connection was established
    at TLSSocket.onConnectEnd (node:_tls_wrap:1732:19)
    at TLSSocket.emit (node:events:530:35)
    at endReadableNT (node:internal/streams/readable:1698:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:90:21) {
  code: 'ECONNRESET',
  path: undefined,
  host: undefined,
  port: undefined,
  localAddress: undefined
}
Error flushing log events: Error: Client network socket disconnected before secure TLS connection was established
    at TLSSocket.onConnectEnd (node:_tls_wrap:1732:19)
    at TLSSocket.emit (node:events:530:35)
    at endReadableNT (node:internal/streams/readable:1698:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:90:21) {
  code: 'ECONNRESET',
  path: undefined,
  host: undefined,
  port: undefined,
  localAddress: undefined
}
[fallback/errorDetection] 检查是否应该触发回退: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 判断错误类型: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测Pro模型配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测通用配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测Pro模型配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测配额超限错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测限速错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 检测服务器错误: Error: exception TypeError: fetch failed sending request
    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34
[fallback/errorDetection] 错误类型 unknown_error 不需要触发回退
[fallback/FallbackService] 回退触发检查结果: false
[GeminiApiClient] [回退时序5] 是否需要回退: false
[rotation/RotationService] 报告API Key使用结果: key=AIzaSyAN8B..., success=false, errorType=undefined
[rotation/ApiKeyRotationManager] 报告API Key使用结果: key=AIzaSyAN8B..., success=false, errorType=undefined
[rotation/ApiKeyRotationManager] Key 1 使用失败，连续失败次数: 1
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 开始保存轮换状态
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 准备保存的数据 {
  currentIndex: 1,
  totalRequests: 61,
  keysCount: 3,
  persistenceFile: './data/rotation-state.json'
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 开始保存持久化数据 {
  filePath: '/Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/data/rotation-state.json',
  currentIndex: 1,
  totalRequests: 61,
  keysCount: 3
}
2025-07-25T05:52:39.648Z [BRIDGE-SERVER] [ERROR] false Gemini API请求失败 {
  message: 'exception TypeError: fetch failed sending request',
  stack: 'Error: exception TypeError: fetch failed sending request\n' +
    '    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)\n' +
    '    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)\n' +
    '    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)\n' +
    '    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)\n' +
    '    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34'
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 获取文件锁成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 持久化数据写入文件成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 释放文件锁
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 轮换状态保存成功
2025-07-25T05:52:39.650Z [BRIDGE-SERVER] [ERROR] OpenAI bridge request failed {
  message: 'exception TypeError: fetch failed sending request',
  stack: 'Error: exception TypeError: fetch failed sending request\n' +
    '    at file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13059:19\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)\n' +
    '    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)\n' +
    '    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)\n' +
    '    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)\n' +
    '    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34'
} { requestId: '9dce0a69-325a-4826-b758-805b2fc64302', durationMs: 4039 }
[rotation/ApiKeyRotationManager] Key 1 使用报告处理完成
[rotation/RotationService] API Key使用报告成功提交
2025-07-25T05:52:44.849Z [BRIDGE-SERVER] [INFO] OpenAI bridge request received {
  requestId: 'e38f7d24-ffa8-4c05-a7a0-97679afdb9bd',
  model: 'gemini-2.5-pro',
  stream: true
}
[GeminiApiClient] [请求时序1] 收到sendMessageStream请求
[GeminiApiClient] [请求时序4] 开始获取轮换API Key
[rotation/RotationService] [API请求] 请求获取API Key，当前状态: enabled=true, manager=true, initializing=false
[rotation/RotationService] [API请求] 从轮换管理器获取下一个API Key
[rotation/ApiKeyRotationManager] 请求获取下一个API Key，当前索引: 1
[rotation/ApiKeyRotationManager] 开始轮换查找，最大尝试次数: 3
[rotation/ApiKeyRotationManager] 尝试第1次，检查索引1的Key状态: active
[rotation/ApiKeyRotationManager] Key 2/3 可用，开始使用
[rotation/ApiKeyRotationManager] 已移动到下一个索引: 2
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 开始保存轮换状态
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 准备保存的数据 {
  currentIndex: 2,
  totalRequests: 62,
  keysCount: 3,
  persistenceFile: './data/rotation-state.json'
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 开始保存持久化数据 {
  filePath: '/Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/data/rotation-state.json',
  currentIndex: 2,
  totalRequests: 62,
  keysCount: 3
}
[DEBUG] /rotation/PersistenceService.ts - saveData: 获取文件锁成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 持久化数据写入文件成功
[DEBUG] /rotation/PersistenceService.ts - saveData: 释放文件锁
[DEBUG] /rotation/ApiKeyRotationManager.ts - saveState: 轮换状态保存成功
[rotation/ApiKeyRotationManager] 成功获取API Key: AIzaSyAGqu...
[rotation/RotationService] [API请求] 成功获取轮换API Key: AIzaSyAGqu...
[GeminiApiClient] [请求时序5] 成功获取轮换API Key
[GeminiApiClient] [请求时序6] 开始执行实际请求
[GeminiApiClient] [回退时序4] 当前使用模型: gemini-2.5-pro
2025-07-25T05:52:44.852Z [BRIDGE-SERVER] [INFO] Calling Gemini API { model: 'gemini-2.5-pro' }
[GeminiApiClient] [请求时序7] 使用轮换API Key创建ContentGenerator
[GeminiApiClient] [DEBUG] 动态配置详情: {
  model: 'gemini-2.5-pro',
  hasApiKey: true,
  apiKeyPrefix: 'AIzaSyAGqu...',
  authType: 'gemini-api-key'
}
Attempt 1 failed with status 429. Retrying with backoff... ApiError: {"error":{"message":"{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.\",\n    \"status\": \"RESOURCE_EXHAUSTED\",\n    \"details\": [\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.QuotaFailure\",\n        \"violations\": [\n          {\n            \"quotaMetric\": \"generativelanguage.googleapis.com/generate_content_free_tier_input_token_count\",\n            \"quotaId\": \"GenerateContentInputTokensPerModelPerMinute-FreeTier\",\n            \"quotaDimensions\": {\n              \"location\": \"global\",\n              \"model\": \"gemini-2.5-pro\"\n            },\n            \"quotaValue\": \"250000\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.Help\",\n        \"links\": [\n          {\n            \"description\": \"Learn more about Gemini API quotas\",\n            \"url\": \"https://ai.google.dev/gemini-api/docs/rate-limits\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.RetryInfo\",\n        \"retryDelay\": \"12s\"\n      }\n    ]\n  }\n}\n","code":429,"status":"Too Many Requests"}}
    at throwErrorIfNotOK (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13187:30)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:12978:13
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34 {
  status: 429
}
Attempt 2 failed with status 429. Retrying with backoff... ApiError: {"error":{"message":"{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.\",\n    \"status\": \"RESOURCE_EXHAUSTED\",\n    \"details\": [\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.QuotaFailure\",\n        \"violations\": [\n          {\n            \"quotaMetric\": \"generativelanguage.googleapis.com/generate_content_free_tier_input_token_count\",\n            \"quotaId\": \"GenerateContentInputTokensPerModelPerMinute-FreeTier\",\n            \"quotaDimensions\": {\n              \"model\": \"gemini-2.5-pro\",\n              \"location\": \"global\"\n            },\n            \"quotaValue\": \"250000\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.Help\",\n        \"links\": [\n          {\n            \"description\": \"Learn more about Gemini API quotas\",\n            \"url\": \"https://ai.google.dev/gemini-api/docs/rate-limits\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.RetryInfo\",\n        \"retryDelay\": \"5s\"\n      }\n    ]\n  }\n}\n","code":429,"status":"Too Many Requests"}}
    at throwErrorIfNotOK (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13187:30)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:12978:13
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34 {
  status: 429
}
Attempt 3 failed with status 429. Retrying with backoff... ApiError: {"error":{"message":"{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.\",\n    \"status\": \"RESOURCE_EXHAUSTED\",\n    \"details\": [\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.QuotaFailure\",\n        \"violations\": [\n          {\n            \"quotaMetric\": \"generativelanguage.googleapis.com/generate_content_free_tier_input_token_count\",\n            \"quotaId\": \"GenerateContentInputTokensPerModelPerMinute-FreeTier\",\n            \"quotaDimensions\": {\n              \"location\": \"global\",\n              \"model\": \"gemini-2.5-pro\"\n            },\n            \"quotaValue\": \"250000\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.Help\",\n        \"links\": [\n          {\n            \"description\": \"Learn more about Gemini API quotas\",\n            \"url\": \"https://ai.google.dev/gemini-api/docs/rate-limits\"\n          }\n        ]\n      },\n      {\n        \"@type\": \"type.googleapis.com/google.rpc.RetryInfo\",\n        \"retryDelay\": \"52s\"\n      }\n    ]\n  }\n}\n","code":429,"status":"Too Many Requests"}}
    at throwErrorIfNotOK (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:13187:30)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:12978:13
    at async Models.generateContentStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/node_modules/@google/genai/dist/node/index.mjs:14308:24)
    at async retryWithBackoff (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/utils/retry.js:62:20)
    at async GeminiChat.sendMessageStream (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/core/dist/src/core/geminiChat.js:303:36)
    at async GeminiApiClient.executeStreamRequest (file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/gemini-client.js:386:34)
    at async file:///Users/sss/devprog/item_intre/gemini-cli-mcp-openai-bridge/gemini-cli/packages/bridge-server/dist/bridge/openai.js:36:34 {
  status: 429
}
